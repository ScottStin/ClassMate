<div
  class="scene scene--card"
  [style]="userType === 'school' ? 'height: 250vh;' : ''"
>
  <div
    [class]="userType === 'school' ? 'card-school' : 'card'"
    [class.is-flipped]="isFlipped"
    [style]="'box-shadow: 0 40px 60px ' + selectedBackgroundImage?.shadow"
  >
    <mat-card
      [class]="title === 'signup' ? 'card__face card__face--front' : 'card__face card__face--back'"
    >
      <mat-card-header>
        <mat-card-title>{{title | titlecase}}</mat-card-title>
      </mat-card-header>

      <div class="image-container">
        <img
          *ngIf="!photoName"
          mat-card-image
          [src]="photoSrc"
          alt="Login Photo"
        />
        <image-cropper
          format="png"
          [imageChangedEvent]="imageChangedEvent"
          [maintainAspectRatio]="true"
          [aspectRatio]="5 / 3"
          [resizeToWidth]="128"
          (imageCropped)="imageCropped($event)"
          (imageLoaded)="imageLoaded()"
          (cropperReady)="cropperReady()"
          (loadImageFailed)="loadImageFailed()"
        ></image-cropper>
      </div>

      <mat-card-content *ngIf="userType !== 'school'">
        <div [formGroup]="loginForm" *ngIf="loginForm">
          <!-- -- --- --- --- --- -- -->
          <!-- --- ---  NAME --- --- -->
          <!-- -- --- --- --- --- -- -->
          <mat-form-field
            *ngIf="title === 'signup'"
            class="form-field"
            appearance="outline"
          >
            <mat-label>Name</mat-label>
            <input
              matInput
              id="nameInput"
              formControlName="nameInput"
              type="text"
              placeholder="Enter your first and last name"
              [required]="title === 'signup'"
            />
            <mat-error>
              <app-error-message
                [control]="loginForm.controls['nameInput'].errors"
              ></app-error-message>
            </mat-error>
          </mat-form-field>

          <!-- -- --- --- --- --- -- -->
          <!-- --- ---  EMAIL --- --- ->
          <!-- -- --- --- --- --- -- -->

          <mat-form-field class="form-field" appearance="outline">
            <mat-label>Email</mat-label>
            <input
              matInput
              id="emailInput"
              formControlName="emailInput"
              type="email"
              placeholder="Email address (e.g. john@gmail.com)"
              required
            />
            <mat-error>
              <app-error-message
                [control]="loginForm.controls['emailInput'].errors"
              ></app-error-message>
            </mat-error>
          </mat-form-field>

          <!-- -- --- --- --- --- -- -->
          <!-- --- -  COUNTRY --- --- ->
          <!-- -- --- --- --- --- -- -->

          <mat-form-field
            *ngIf="title === 'signup'"
            class="form-field"
            appearance="outline"
          >
            <mat-label
              >Country of Origin
              <span *ngIf="userType === 'student'">(Optional)</span></mat-label
            >
            <mat-select
              formControlName="countryInput"
              [required]="userType === 'teacher' && title === 'signup'"
            >
              <mat-option value="other">Select country...</mat-option>
              <mat-option *ngFor="let country of countryList" [value]="country">
                {{ country }}
              </mat-option>
              <mat-option value="other">OTHER</mat-option>
            </mat-select>
          </mat-form-field>

          <!-- -- --- --- --- --- -- -->
          <!-- ---- STATEMENT --- --- ->
          <!-- -- --- --- --- --- -- -->

          <mat-form-field
            *ngIf="title === 'signup' && userType === 'teacher'"
            class="form-field"
            appearance="outline"
          >
            <mat-label>Personal Statement</mat-label>
            <textarea
              matInput
              id="personalStatement"
              formControlName="personalStatement"
              type="text"
              placeholder="Tell your students a little bit about yourself..."
              [required]="title === 'signup' && userType === 'teacher'"
            ></textarea>
            <mat-error>
              <app-error-message
                [control]="loginForm.controls['personalStatement'].errors"
              ></app-error-message>
            </mat-error>
          </mat-form-field>

          <!-- -- --- --- --- --- -- -->
          <!---------- PASSWORD ------->
          <!-- -- --- --- --- --- -- -->

          <mat-form-field class="form-field" appearance="outline">
            <mat-label>Password</mat-label>
            <input
              matInput
              id="passwordInput"
              formControlName="passwordInput"
              [type]="hidePassword ? 'password' : 'text'"
              placeholder="Enter your password"
              required
            />
            <button
              mat-icon-button
              matSuffix
              (click)="hidePassword = !hidePassword"
              [attr.aria-label]="'Hide password'"
              [attr.aria-pressed]="hidePassword"
            >
              <mat-icon
                *ngIf="this.loginForm.getRawValue().passwordInput !== ''"
                >{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon
              >
            </button>
            <mat-error>
              <app-error-message
                [control]="loginForm.controls['passwordInput'].errors"
              ></app-error-message>
            </mat-error>
          </mat-form-field>

          <mat-form-field
            appearance="outline"
            class="form-field"
            *ngIf="title === 'signup' && this.loginForm.getRawValue().passwordInput !== ''"
          >
            <mat-label>Confirm Password</mat-label>
            <input
              matInput
              id="passwordMatchInput"
              formControlName="passwordMatchInput"
              [type]="hidePassword ? 'password' : 'text'"
              placeholder="Re-enter your password"
              [required]="title === 'signup'"
            />
            <mat-error>
              <app-error-message
                [control]="loginForm.controls['passwordMatchInput'].errors"
              ></app-error-message>
            </mat-error>
          </mat-form-field>
        </div>
      </mat-card-content>

      <!-- -- --- --- --- ------- ----- -->
      <!-- -- --- --- --- ------- ----- -->
      <!-- -- --- --- --- ------- ----- -->
      <!-- --  SCHOOL CARD ------- ------->
      <!-- -- --- --- --- --- ------ ----->
      <!-- -- --- --- --- --- ------ ----->
      <!-- -- --- --- --- --- ------ ----->

      <mat-card-content *ngIf="userType === 'school'">
        <div *ngIf="loginFormSchool" [formGroup]="loginFormSchool">
          <mat-stepper
            [linear]="true"
            #stepper
            [ngStyle]="{
              '--primaryButtonBackgroundColor': primaryButtonBackgroundColor,
              '--primaryButtonTextColor': primaryButtonTextColor
            }"
          >
            <!-- -- --- --- --- --- -- -->
            <!-- --- ---  NAME STEP --- --- -->
            <!-- -- --- --- --- --- -- -->
            <mat-step
              *ngIf="loginFormSchool.controls['detailStep'] as detailStepForm"
              label="Details"
              [editable]="true"
              [completed]="true"
              [stepControl]="detailStepForm"
              formGroupName="detailStep"
            >
              <div class="step-container">
                <mat-form-field
                  *ngIf="title === 'signup'"
                  class="form-field"
                  appearance="outline"
                >
                  <mat-label>Name of School</mat-label>
                  <input
                    matInput
                    id="nameInput"
                    formControlName="nameInput"
                    type="text"
                    placeholder="Enter the name of your school"
                    [required]="title === 'signup'"
                  />
                  <mat-error>
                    <app-error-message
                      [control]="detailStepForm.controls['nameInput'].errors"
                    ></app-error-message>
                  </mat-error>
                </mat-form-field>

                <!-- -- --- --- --- --- -- -->
                <!-- --- ---  EMAIL --- --- ->
                  <!-- -- --- --- --- --- -- -->

                <mat-form-field class="form-field" appearance="outline">
                  <mat-label>School Email</mat-label>
                  <input
                    matInput
                    id="emailInput"
                    formControlName="emailInput"
                    type="email"
                    placeholder="Email address of your school (e.g. admin@my-school.com)"
                    required
                  />
                  <mat-error>
                    <app-error-message
                      [control]="detailStepForm.controls['emailInput'].errors"
                    ></app-error-message>
                  </mat-error>
                </mat-form-field>

                <!-- -- --- --- --- --- -- -->
                <!-- --- -  COUNTRY --- --- ->
                  <!-- -- --- --- --- --- -- -->

                <mat-form-field
                  *ngIf="title === 'signup'"
                  class="form-field"
                  appearance="outline"
                >
                  <mat-label>School's Base Country (Optional)</mat-label>
                  <mat-select formControlName="countryInput">
                    <mat-option value="other">Select country...</mat-option>
                    <mat-option
                      *ngFor="let country of countryList"
                      [value]="country"
                    >
                      {{ country }}
                    </mat-option>
                    <mat-option value="other">OTHER</mat-option>
                  </mat-select>
                </mat-form-field>

                <!-- -- --- --- --- --- -- -->
                <!-- ---- STATEMENT --- --- ->
                  <!-- -- --- --- --- --- -- -->

                <mat-form-field
                  *ngIf="title === 'signup'"
                  class="form-field"
                  appearance="outline"
                >
                  <mat-label>School Description</mat-label>
                  <textarea
                    matInput
                    id="descriptionInput"
                    formControlName="descriptionInput"
                    type="text"
                    placeholder="Tell your students a little bit about your school..."
                    [required]="title === 'signup'"
                  ></textarea>
                  <mat-error>
                    <app-error-message
                      [control]="detailStepForm.controls['descriptionInput'].errors"
                    ></app-error-message>
                  </mat-error>
                </mat-form-field>

                <!-- -- --- --- --- --- -- -->
                <!---------- PASSWORD ------->
                <!-- -- --- --- --- --- -- -->

                <mat-form-field class="form-field" appearance="outline">
                  <mat-label>Password</mat-label>
                  <input
                    matInput
                    id="passwordInput"
                    formControlName="passwordInput"
                    [type]="hidePassword ? 'password' : 'text'"
                    placeholder="Enter your password"
                    required
                  />
                  <button
                    mat-icon-button
                    matSuffix
                    (click)="hidePassword = !hidePassword"
                    [attr.aria-label]="'Hide password'"
                    [attr.aria-pressed]="hidePassword"
                  >
                    <mat-icon
                      *ngIf="this.loginFormSchool.controls['detailStep'].getRawValue().passwordInput !== ''"
                      >{{hidePassword ? 'visibility_off' :
                      'visibility'}}</mat-icon
                    >
                  </button>
                  <mat-error>
                    <app-error-message
                      [control]="detailStepForm.controls['passwordInput'].errors"
                    ></app-error-message>
                  </mat-error>
                </mat-form-field>

                <mat-form-field
                  appearance="outline"
                  class="form-field"
                  *ngIf="title === 'signup' && this.loginFormSchool.controls['detailStep'].getRawValue().passwordInput !== ''"
                >
                  <mat-label>Confirm Password</mat-label>
                  <input
                    matInput
                    id="passwordMatchInput"
                    formControlName="passwordMatchInput"
                    [type]="hidePassword ? 'password' : 'text'"
                    placeholder="Re-enter your password"
                    [required]="title === 'signup'"
                  />
                  <mat-error>
                    <app-error-message
                      [control]="detailStepForm.controls['passwordMatchInput'].errors"
                    ></app-error-message>
                  </mat-error>
                </mat-form-field>
                <div class="stepper-navigation">
                  <button
                    mat-button
                    matStepperNext
                    [disabled]="this.loginFormSchool.controls['detailStep'].invalid"
                    class="stepper-next-button"
                    [ngStyle]="{
                      '--primaryButtonBackgroundColor': primaryButtonBackgroundColor,
                      '--primaryButtonTextColor': primaryButtonTextColor
                    }"
                  >
                    <span>Next</span>
                  </button>
                </div>
              </div>
            </mat-step>

            <mat-step
              *ngIf="loginFormSchool.controls['formatStep'] as formatStepForm"
              label="Format"
              [editable]="true"
              [completed]="true"
              [stepControl]="formatStepForm"
              formGroupName="formatStep"
            >
              <!-- -- --- --- --- --- -- -->
              <!-- BACKGROUND IMAGE STEP -->
              <!-- -- --- --- --- --- -- -->

              <div class="step-container">
                <mat-form-field
                  *ngIf="title === 'signup' && userType === 'school'"
                  class="form-field"
                  appearance="outline"
                >
                  <mat-label>Background image (Optional)</mat-label>
                  <mat-select
                    formControlName="backgroundImageInput"
                    [required]="title === 'signup'"
                  >
                    <mat-option
                      *ngFor="let backgroundImage of backgroundImages"
                      [value]="backgroundImage"
                    >
                      <img
                        [src]="'../../../assets/' + backgroundImage.name"
                        [alt]="backgroundImage.label"
                      />
                    </mat-option>
                  </mat-select>
                </mat-form-field>

                <!-- -- --- --- --- --- -- -->
                <!------- BUTTON COLOR ------>
                <!-- -- --- --- --- --- -- -->

                <mat-form-field
                  class="form-field"
                  appearance="outline"
                  *ngIf="userType === 'school'"
                >
                  <mat-label
                    >Primary Button Background Color (Optional)</mat-label
                  >
                  <input
                    matInput
                    id="primaryButtonBackgroundColor"
                    #primaryButtonBackgroundColor
                    formControlName="primaryButtonBackgroundColor"
                    type="color"
                    placeholder="What color will your buttons be?"
                    [value]="primaryButtonBackgroundColor"
                    (change)="changePrimaryButtonBackgroundColor(primaryButtonBackgroundColor.value)"
                  />
                  <mat-error>
                    <app-error-message
                      [control]="formatStepForm.controls['primaryButtonBackgroundColor'].errors"
                    ></app-error-message>
                  </mat-error>
                </mat-form-field>

                <mat-form-field
                  class="form-field"
                  appearance="outline"
                  *ngIf="userType === 'school'"
                >
                  <mat-label>Primary Button Text Color (Optional)</mat-label>
                  <input
                    matInput
                    id="primaryButtonTextColor"
                    #primaryButtonTextColor
                    formControlName="primaryButtonTextColor"
                    type="color"
                    placeholder="What color will your button text be?"
                    value="#FFFFFF"
                    (change)="changePrimaryButtonTextColor(primaryButtonTextColor.value)"
                  />
                  <mat-error>
                    <app-error-message
                      [control]="formatStepForm.controls['primaryButtonTextColor'].errors"
                    ></app-error-message>
                  </mat-error>
                </mat-form-field>
                <div class="stepper-navigation">
                  <button mat-button matStepperPrevious>Back</button>
                  <button
                    mat-button
                    matStepperNext
                    [disabled]="false"
                    class="stepper-next-button"
                    [ngStyle]="{
                      '--primaryButtonBackgroundColor': primaryButtonBackgroundColor,
                      '--primaryButtonTextColor': primaryButtonTextColor
                    }"
                  >
                    <span *ngIf="this.formatStepForm?.dirty">Next</span>
                    <span
                      *ngIf="!this.formatStepForm?.dirty"
                      class="skip-button"
                      >Skip this step <mat-icon>skip_next</mat-icon></span
                    >
                  </button>
                </div>
              </div>
            </mat-step>
            <mat-step label="Logo" [editable]="true" [completed]="true">
              <div class="step-container">
                <!-- -- --- --- --- --- -- -->
                <!------- SCHOOL LOGO ------->
                <!-- -- --- --- --- --- -- -->

                <!-- Image Cropper: -->
                <mat-form-field
                  *ngIf="title === 'signup' && userType === 'school'"
                  class="form-field"
                  appearance="outline"
                >
                  <mat-label>School Logo (Optional)</mat-label>
                  <input
                    #photoInput
                    type="file"
                    hidden="true"
                    (change)="fileChangeEvent($event)"
                    accept="image/png, image/jpeg, image/gif, image/tiff"
                  />
                  <input
                    (click)="photoInput.click()"
                    matInput
                    readonly
                    [placeholder]="photoName || 'No file chosen'"
                  />
                  <mat-icon
                    matSuffix
                    style="cursor: pointer"
                    (click)="photoInput.click()"
                    >add_photo_alternate</mat-icon
                  >
                </mat-form-field>

                <!-- <button
                      mat-raised-button
                      [style]="'background-color: ' + primaryButtonBackgroundColor + '; color: ' + primaryButtonTextColor"
                    >
                      Example Button
                    </button> -->
                <div class="stepper-navigation">
                  <button mat-button matStepperPrevious>Back</button>
                  <button
                    mat-button
                    matStepperNext
                    [disabled]="false"
                    class="stepper-next-button"
                    [ngStyle]="{
                      '--primaryButtonBackgroundColor': primaryButtonBackgroundColor,
                      '--primaryButtonTextColor': primaryButtonTextColor
                    }"
                  >
                    <span *ngIf="photoName">Next</span>
                    <span class="skip-button" *ngIf="!photoName"
                      >Skip this step <mat-icon>skip_next</mat-icon></span
                    >
                  </button>
                </div>
              </div>
            </mat-step>
            <mat-step label="Lessons" [editable]="true" [completed]="true">
              <div class="step-container">
                tst4
                <div class="stepper-navigation">
                  <button mat-button matStepperPrevious>Back</button>
                  <!-- <button mat-button matStepperNext [disabled]="false">
                    <span>Next</span>
                  </button> -->
                </div>
              </div>
            </mat-step>
          </mat-stepper>
        </div>
      </mat-card-content>

      <button
        *ngIf="title === 'signup'"
        mat-raised-button
        class="login-signup-button"
        [disabled]="(this.loginFormSchool?.invalid || this.usersLoading) || this.loginFormSchoolStepper.selectedIndex !== (this.loginFormSchoolStepper.steps.length - 1)"
        (click)="signupClick()"
        [ngStyle]="{
          '--primaryButtonBackgroundColor': primaryButtonBackgroundColor,
          '--primaryButtonTextColor': primaryButtonTextColor
        }"
      >
        Sign up
      </button>
      <button
        mat-raised-button
        *ngIf="title === 'login'"
        class="login-signup-button"
        [disabled]="this.loginForm.getRawValue().passwordInput === '' || this.loginForm.getRawValue().emailInput === ''"
        (click)="loginClick()"
      >
        Login
      </button>
      <div class="text-container" (click)="toggleCardFlip()">
        <h6 *ngIf="title === 'signup'" class="login-text">
          Already have an account? Click <b>here</b> to login.
        </h6>
        <h6 *ngIf="title === 'login' " class="login-text">
          New user? Click <b>here</b> to sign up.
        </h6>
      </div>
    </mat-card>
    <mat-progress-bar
      [style]="{ visibility: usersLoading ? 'visible' : 'hidden' }"
      mode="query"
    ></mat-progress-bar>
  </div>
</div>
